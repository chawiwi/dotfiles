##### Core #############################################################
# Shell & terminal
set -g default-shell /bin/zsh

# Prefer modern terminfo if present
set -g default-terminal "tmux-256color"
set -as terminal-overrides ',*:RGB'          # truecolor
set -g focus-events on
set -g escape-time 0

# History, mouse, clipboard
set -g history-limit 1000000
set -g mouse on
set -g set-clipboard on

# Indices & window behavior
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
# setw -g aggressive-resize on

# Don’t kill tmux when last pane/window exits
set -g detach-on-destroy off

# (Only on tmux ≥3.4) allow passthrough for images/kitty
if-shell -b 'tmux -V | awk "{print (\$2>=3.4)}" | grep -q 1' 'set -g allow-passthrough on'
# from molten-nvim recommend
set -g visual-activity off

##### Prefix & reload ##################################################
unbind C-b
set -g prefix C-a
bind r source-file ~/.config/tmux/tmux.conf \; display-message "tmux reloaded"

##### Splits, windows, panes ###########################################
# unbind %
# bind '-' split-window -h -c "#{pane_current_path}"
# unbind '"'
# bind '|' split-window -v -c "#{pane_current_path}"

# New window in same dir
bind c new-window -c "#{pane_current_path}"

# Resize with vim keys
bind -r h resize-pane -L 5
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5

# Zoom
bind -r m resize-pane -Z

# Toggle synchronize-panes
bind o setw synchronize-panes \; display-message "sync-panes: #{?synchronize-panes,on,off}"

##### Copy mode (vim style) ############################################
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
# Let tmux-yank handle system clipboard; still map `y` for habit
bind -T copy-mode-vi y send -X copy-selection-and-cancel
# Keep selection when dragging
unbind -T copy-mode-vi MouseDragEnd1Pane
# Paste
bind P paste-buffer

##### Nested tmux helpers ##############################################
# Local prefix = C-a (yours). Most remotes keep default prefix = C-b.

# 1) Send remote's default prefix (C-b) to the inner session:
#    Press: <local prefix> then b
bind b send-prefix -2

## 2) If a remote ALSO uses your prefix (C-a), send that too:
##    Press: <local prefix> then p
# bind p send-prefix

# Allow a secondary local prefix so the line above can target it with -2
# (We keep C-b as prefix2 locally; it's NOT your main prefix.)
set -g prefix2 C-b

# Optional convenience: raw C-b inside your local tmux will go straight to the inner tmux.
# Comment this out if you use C-b for anything else inside apps.
# bind -n C-b send-prefix -2

##### Status line content (Nord colors handled by the plugin) ##########
set -g status-interval 3
set -g status-left-length 40
set -g status-right-length 120
set -g status-left  "#[bold]#S #[dim]#(whoami)"
set -g status-right "#H | %Y-%m-%d %H:%M"

##### Plugins (TPM) ####################################################
# TPM
set -g @plugin 'tmux-plugins/tpm'

# Your requested theme (no separate color file needed)
set -g @plugin 'arcticicestudio/nord-tmux'

# Navigation between nvim and tmux
set -g @plugin 'christoomey/vim-tmux-navigator'

# System clipboard yanks from copy-mode (auto-detects pbcopy/xclip/wl-copy)
set -g @plugin 'tmux-plugins/tmux-yank'

# Session persistence
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'

# Auto-save/restore sessions
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'

# Optional CPU/MEM monitor (if you like it)
set -g @plugin 'hendrikmi/tmux-cpu-mem-monitor'

# Initialize TPM (keep last)
run '~/.tmux/plugins/tpm/tpm'
